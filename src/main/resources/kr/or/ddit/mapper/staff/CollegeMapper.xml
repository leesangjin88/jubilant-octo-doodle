<?xml version="1.0" encoding="UTF-8"?>
<!--
 * << 개정이력(Modification Information) >>
 * 수정일		수정자		수정 내용
 * ======================================
 * 250702   김규민        최초 생성
 * 250703   김규민        단대 상세 조회 수정
 * 250709   김규민        단대 등록 수정
 * 250716	김규민		단대 삭제 추가
 -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.pfcp.staff.college.mapper.CollegeMapper">

<resultMap id="collegeMap" type="CollegeVO" autoMapping="true">
		<id property="collegeNo" column="COLLEGE_NO" />
		<result property="collegeName" column="COLLEGE_NAME" />
	
	
		<!-- Department Association -->
		<association property="department" javaType="kr.or.ddit.pfcp.common.vo.DepartmentVO" autoMapping="true" />
		
	</resultMap>


	<select id="selectAllCollegeList" resultMap="collegeMap">
	<!-- 전체 단대 조회 -->
	SELECT
		C.COLLEGE_NO,
		C.COLLEGE_NAME,
		COUNT(D.COLLEGE_NO) AS DCOUNT
	FROM
		COLLEGE C
		LEFT JOIN
		DEPARTMENT D ON C.COLLEGE_NO = D.COLLEGE_NO AND D.DEL_YN = 'N'
	WHERE C.DEL_YN = 'N'
	GROUP BY
		C.COLLEGE_NO, C.COLLEGE_NAME
	ORDER BY
	    C.COLLEGE_NO
	
	</select>

	<select id="selectCollege">
	<!-- 단대 상세조회(학과) -->
		SELECT DEPARTMENT_NO
			   , DEPARTMENT_NAME
		FROM DEPARTMENT
		WHERE COLLEGE_NO = #{collegeNo}
	</select>
	
	<insert id="insertCollege">
		INSERT INTO COLLEGE (
			COLLEGE_NO
			,COLLEGE_NAME
		) VALUES (
			'CL' || LPAD(SEQ_COLLEGE.NEXTVAL, 3, '0')
			,#{collegeName}
		)
	</insert>
	
	<!-- 삭제 상태 변화 -->
	<update id="updateCollegeDelYN" parameterType="String">
		UPDATE COLLEGE
		SET DEL_YN = 'Y'
		WHERE COLLEGE_NO = #{collegeNo}
	</update>
	
	<!-- 
	<update id="updateCollege">
		UPDATE COLLEGE
			COLLEGE_NO
			, COLLEGE_NAME
		WHERE COLLEGE_NO = #{collegeNo}
	</update>
	-->
	
</mapper>